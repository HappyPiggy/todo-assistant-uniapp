# 需求文档 - 修复安卓端下拉刷新冲突问题

## 介绍

当前在安卓端的 TodoBook 详情页面中，页面级下拉刷新功能与 VirtualTaskList 组件的 scroll-view 产生冲突，导致用户无法正常下拉刷新，任务列表出现上下跳动现象，严重影响用户体验。

## 背景

- 当前实现：使用 uni-app 页面级 `onPullDownRefresh` + VirtualTaskList 的自定义 `scroll-view`
- 问题平台：安卓端（iOS 端可能不受影响）
- 核心组件：VirtualTaskList 实现了虚拟滚动和任务项复用，性能优化关键组件

## 需求

### 需求 1 - 修复安卓端下拉刷新冲突

**用户故事：** 作为安卓用户，当我在 TodoBook 详情页面进行下拉刷新操作时，我希望能够流畅地完成刷新，获取最新的任务数据，而不会出现列表抖动或无法滚动的问题。

#### 验收标准

1. When 用户在安卓端的 TodoBook 详情页面进行下拉刷新操作时，系统应当平滑响应刷新手势，不出现列表上下跳动现象。

2. When 下拉刷新触发时，系统应当正确加载最新的任务数据，包括任务状态、评论数据等，并更新页面显示。

3. When 下拉刷新完成后，用户应当能够正常滚动任务列表，VirtualTaskList 的虚拟滚动功能应当正常工作。

4. When 下拉刷新操作进行时，系统应当显示适当的加载状态提示，用户能够清楚知道刷新正在进行。

5. While 保持 VirtualTaskList 组件的虚拟滚动和任务项复用机制不变，系统应当确保下拉刷新功能与现有性能优化不冲突。

6. When 在 iOS 端进行相同操作时，系统应当继续保持正常的下拉刷新体验（确保修复不影响其他平台）。

### 需求 2 - 保持组件架构稳定性

**用户故事：** 作为开发者，当我修复下拉刷新问题时，我希望 VirtualTaskList 组件的核心架构和性能优化保持不变，确保大量任务数据的流畅显示。

#### 验收标准

1. While 修复下拉刷新问题，VirtualTaskList 组件应当继续支持虚拟滚动功能，只渲染可见区域的任务项。

2. When 任务列表包含大量数据时，系统应当保持流畅的滚动性能，任务项复用机制应当正常工作。

3. When 任务数据更新时，系统应当正确更新虚拟列表的显示内容，不影响用户的浏览位置。

4. While 保持现有的评论缓存清理机制，下拉刷新应当能够正确清理并重新加载评论数据。

## 技术约束

1. **组件复用性**：VirtualTaskList 组件必须保持可复用性，不能为了解决这个问题而与特定页面强耦合
2. **性能要求**：虚拟滚动的性能优化不能被破坏
3. **跨平台兼容**：修复方案不能影响 iOS 或其他平台的正常功能
4. **向后兼容**：现有的数据加载、缓存机制应当保持不变

## 预期效果

修复完成后，安卓端用户应当能够：
- 正常进行下拉刷新操作
- 流畅滚动任务列表
- 获取最新的任务和评论数据
- 享受与 iOS 端一致的用户体验