# 实施计划 - 项目册分享功能

## 阶段一：数据库和云函数开发

### 1. 数据库Schema设计和创建
- [ ] 1.1 创建todobook_shares数据表Schema文件
  - 定义表结构、字段类型和权限规则
  - 创建相应的索引（share_code唯一索引、creator_id普通索引）
  - _需求: 需求2、需求4_

- [ ] 1.2 扩展todobooks表Schema
  - 添加is_share_template、template_creator_id、template_created_at字段
  - 更新表权限规则支持分享模板
  - _需求: 需求1、需求4_

### 2. 云函数分享模块开发
- [ ] 2.1 创建分享模块基础结构
  - 在todobook-co云函数中创建module/share目录
  - 创建share模块的index.js入口文件
  - _需求: 需求1-4_

- [ ] 2.2 实现createShare云函数方法
  - 验证用户分享数量限制（最多2个）
  - 复制原项目册创建分享模板（标记is_share_template=true）
  - 重置所有任务状态为未完成
  - 根据includeComments参数处理评论数据
  - 生成6位随机分享码（确保唯一性）
  - 创建todobook_shares记录
  - _需求: 需求1_

- [ ] 2.3 实现deleteShare云函数方法
  - 验证分享记录所有权
  - 删除云端分享模板项目册及相关任务数据
  - 删除todobook_shares记录
  - _需求: 需求2_

- [ ] 2.4 实现getMyShares云函数方法
  - 查询当前用户的分享记录
  - 关联查询shared_todobook_id对应的项目册信息
  - 返回分享列表（包含项目册名称、图标、描述、分享码等）
  - _需求: 需求2_

- [ ] 2.5 实现importByCode云函数方法
  - 验证分享码有效性
  - 获取分享模板项目册数据
  - 克隆为新项目册（添加"（来自分享）"后缀）
  - 设置当前用户为新项目册创建者
  - 更新分享统计数据（share_count、last_import_at）
  - _需求: 需求3_

- [ ] 2.6 实现getSharePreview云函数方法
  - 验证分享码有效性
  - 获取分享模板基本信息（名称、描述、任务数量）
  - 获取分享创建者信息
  - _需求: 需求3_

### 3. 云函数工具类开发
- [ ] 3.1 开发分享码生成工具
  - 创建6位字母数字组合生成函数
  - 实现分享码唯一性检查
  - 添加生成重试机制
  - _需求: 需求1_

- [ ] 3.2 开发项目册克隆工具
  - 实现深度复制项目册结构
  - 处理任务和子任务的递归复制
  - 实现评论数据的条件复制
  - 重置任务状态和时间戳
  - _需求: 需求1、需求3_

## 阶段二：前端页面和组件开发

### 4. 组合式函数开发
- [ ] 4.1 创建useShareData组合式函数
  - 创建pages/settings/composables/useShareData.js文件
  - 实现分享相关的响应式数据管理
  - 实现与云对象的交互方法
  - 添加错误处理和加载状态管理
  - _需求: 需求1-3_

### 5. 项目册详情页分享功能
- [ ] 5.1 在项目册详情页添加分享菜单项
  - 修改pages/todobooks/detail.vue页面
  - 在菜单中添加"分享"选项和对应图标
  - _需求: 需求1_

- [ ] 5.2 创建分享对话框组件
  - 创建pages/todobooks/components/ShareDialog.vue组件
  - 实现分享设置界面（是否包含评论选项）
  - 实现分享码生成和显示
  - 添加一键复制分享码功能
  - 添加分享数量限制提示
  - _需求: 需求1_

### 6. 设置页面分享管理
- [ ] 6.1 在设置页面添加分享管理入口
  - 修改pages/ucenter/ucenter.vue页面
  - 添加"分享管理"菜单项
  - _需求: 需求2_

- [ ] 6.2 创建分享管理页面
  - 创建pages/settings/share-management.vue页面
  - 实现页面基础布局和导航
  - _需求: 需求2、需求3_

- [ ] 6.3 创建我的分享列表组件
  - 创建pages/settings/components/ShareList.vue组件
  - 实现分享项目册的卡片式展示
  - 显示项目册名称、图标、描述、分享码
  - 添加一键复制分享码功能
  - 实现删除分享功能（包含二次确认）
  - _需求: 需求2_

- [ ] 6.4 创建导入分享组件
  - 创建pages/settings/components/ImportShare.vue组件
  - 实现分享码输入和格式验证
  - 实现分享预览功能
  - 实现导入确认和执行
  - 添加导入成功反馈
  - _需求: 需求3_

### 7. 页面路由配置
- [ ] 7.1 配置分享管理页面路由
  - 在pages.json中添加share-management页面配置
  - 设置页面标题和样式
  - _需求: 需求2、需求3_

## 阶段三：样式和交互优化

### 8. UI样式开发
- [ ] 8.1 设计分享对话框样式
  - 实现与应用一致的设计风格
  - 使用uni-ui组件库标准组件
  - 分享码使用等宽字体显示
  - 添加加载状态和错误状态样式
  - _需求: 需求1_

- [ ] 8.2 设计分享管理页面样式
  - 实现卡片式布局展示分享项目册
  - 设计导入分享的输入界面
  - 添加响应式布局支持
  - 优化移动端显示效果
  - _需求: 需求2、需求3_

### 9. 交互体验优化
- [ ] 9.1 优化分享流程交互
  - 添加分享操作的明确成功反馈
  - 实现分享过程的加载状态提示
  - 添加操作结果的toast提示
  - _需求: 需求1_

- [ ] 9.2 优化导入流程交互
  - 实现分享码预览确认步骤
  - 添加导入过程的加载状态
  - 实现导入成功后的页面跳转
  - 添加错误处理和用户友好提示
  - _需求: 需求3_

- [ ] 9.3 优化删除操作交互
  - 实现删除分享的二次确认机制
  - 添加删除操作的加载状态
  - 提供清晰的操作结果反馈
  - _需求: 需求2_

## 阶段四：测试和集成

### 10. 功能测试
- [ ] 10.1 分享功能测试
  - 测试分享创建流程
  - 测试分享数量限制（2个上限）
  - 测试评论包含/不包含选项
  - 测试分享码生成和唯一性
  - _需求: 需求1、需求4_

- [ ] 10.2 导入功能测试
  - 测试分享码验证机制
  - 测试项目册克隆过程
  - 测试导入后的数据完整性
  - 测试"（来自分享）"后缀添加
  - _需求: 需求3_

- [ ] 10.3 分享管理测试
  - 测试分享列表显示
  - 测试分享删除功能
  - 测试删除后的数据清理
  - 测试已导入项目册不受删除影响
  - _需求: 需求2、需求4_

### 11. 数据隔离测试
- [ ] 11.1 测试数据隔离机制
  - 验证分享模板与原项目册隔离
  - 验证导入项目册与分享模板隔离  
  - 测试原项目册修改不影响分享模板
  - 测试分享删除不影响已导入项目册
  - _需求: 需求4_

### 12. 错误处理和边界测试
- [ ] 12.1 异常情况测试
  - 测试无效分享码处理
  - 测试网络异常情况
  - 测试权限验证机制
  - 测试数据库操作失败处理
  - _需求: 需求1-4_

- [ ] 12.2 边界条件测试
  - 测试分享码格式验证
  - 测试分享数量上限控制
  - 测试大型项目册分享性能
  - 测试并发操作处理
  - _需求: 需求1、需求4_

## 阶段五：部署和文档

### 13. 部署准备
- [ ] 13.1 数据库Schema部署
  - 在uniCloud控制台创建todobook_shares数据表
  - 更新todobooks表Schema
  - 创建必要的数据库索引
  - _需求: 需求1-4_

- [ ] 13.2 云函数部署
  - 部署更新后的todobook-co云函数
  - 验证所有分享相关API接口
  - 测试线上环境功能完整性
  - _需求: 需求1-4_

### 14. 用户测试和反馈
- [ ] 14.1 功能验收测试
  - 按照需求文档验收标准逐项测试
  - 验证所有用户故事场景
  - 收集测试反馈并修复问题
  - _需求: 需求1-4_

- [ ] 14.2 性能和稳定性测试
  - 测试分享功能在不同设备上的表现
  - 验证大量数据情况下的性能
  - 确保功能稳定可靠
  - _需求: 需求1-4_