# 实施计划

## 任务列表

- [ ] 1. 清理现有统计组件和创建基础结构
  - [ ] 1.1 备份并清理现有统计相关组件
    - 移除或归档现有的时间分析相关组件
    - 清理未使用的统计工具函数
    - _需求: 1.1_
  - [ ] 1.2 更新 StatisticsTabBar 组件
    - 修改为只包含"总览统计"和"消费统计"两个 tab
    - 更新图标和样式
    - _需求: 1.1, 1.2, 1.4_
  - [ ] 1.3 创建新的组件文件结构
    - 创建 StatisticsOverviewTab.vue
    - 创建 StatisticsExpenseTab.vue
    - 创建 ExpensePieChart.vue
    - _需求: 1.1_

- [ ] 2. 实现数据处理 composables
  - [ ] 2.1 创建 useExpenseData composable
    - 实现计算总预算和总支出的函数
    - 实现按标签分组统计的函数
    - 实现排序逻辑（按金额从高到低）
    - 添加单元测试验证计算准确性
    - _需求: 3.1, 4.1, 4.3, 7.3_
  - [ ] 2.2 扩展 useBookData composable
    - 添加获取已完成任务时间线的方法
    - 优化数据获取逻辑，确保一次性加载所有需要的数据
    - 实现数据缓存机制
    - _需求: 2.1, 2.2, 2.5_

- [ ] 3. 实现总览统计功能
  - [ ] 3.1 开发 StatisticsOverviewTab 组件
    - 创建项目册信息卡片（显示任务量、完成数、完成率）
    - 实现基础布局和样式
    - 连接 useBookData 获取数据
    - _需求: 2.1_
  - [ ] 3.2 优化任务时间线组件
    - 修改现有 TaskTimelineChart 组件支持点击导航
    - 实现任务点击跳转到详情页
    - 优化时间格式显示
    - _需求: 2.2, 2.4_
  - [ ] 3.3 实现时间线虚拟滚动
    - 检测任务数量，超过 100 个时启用虚拟滚动
    - 实现可视区域计算逻辑
    - 添加滚动性能优化
    - 编写性能测试用例
    - _需求: 2.3, 6.1_

- [ ] 4. 实现消费统计功能
  - [ ] 4.1 开发 StatisticsExpenseTab 组件基础功能
    - 创建总预算和总支出显示卡片
    - 实现预算超支警示显示
    - 连接 useExpenseData 获取数据
    - _需求: 3.1, 3.3_
  - [ ] 4.2 实现标签支出饼图
    - 开发 ExpensePieChart 组件
    - 集成图表库（ucharts 或自定义 canvas）
    - 实现饼图数据绑定
    - 处理无标签的空状态显示
    - _需求: 4.1, 4.4_
  - [ ] 4.3 实现标签详细列表
    - 创建标签列表组件
    - 显示标签名、支出占比、任务数量
    - 实现按金额排序显示
    - _需求: 4.2, 4.3_
  - [ ] 4.4 实现预算/支出视图切换
    - 添加切换按钮组件
    - 实现视图模式状态管理
    - 更新饼图和列表数据响应切换
    - 保存用户视图偏好到本地存储
    - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ] 5. 集成和优化
  - [ ] 5.1 更新主统计页面
    - 修改 statistics.vue 集成新组件
    - 实现 tab 切换逻辑
    - 保持滑动切换功能
    - _需求: 1.2, 1.4_
  - [ ] 5.2 实现数据加载和错误处理
    - 添加加载状态指示器
    - 实现错误处理和重试机制
    - 优化数据加载时机
    - _需求: 6.4, 7.1, 7.2_
  - [ ] 5.3 性能优化
    - 实现计算结果缓存
    - 优化大数据量渲染
    - 确保图表渲染在 500ms 内完成
    - _需求: 6.2, 6.3_

- [ ] 6. 样式和用户体验优化
  - [ ] 6.1 创建统一的样式文件
    - 更新 statistics.scss
    - 实现响应式布局
    - 优化移动端显示效果
    - _需求: 1.3, 6.3_
  - [ ] 6.2 添加交互反馈
    - 实现平滑的 tab 切换动画
    - 添加点击反馈效果
    - 优化加载和空状态显示
    - _需求: 1.2, 6.3_

