# 需求文档

## 简介

优化项目册统计页面，提供更清晰的数据可视化和分析功能。将现有统计功能重新组织为两个主要模块：总览统计和消费统计，为用户提供项目进度和财务支出的全面洞察。

## 需求

### 需求 1：Tab结构重组

**用户故事：** 作为项目管理者，我希望有清晰的统计视图分类，以便快速访问不同维度的统计数据

#### 接受标准

1. 当用户访问统计页面时，系统应显示两个tab：总览统计和消费统计
2. 当用户点击tab时，系统应切换到对应的统计视图
3. 系统应清理现有的所有统计相关tab内容
4. 系统应记住用户最后访问的tab状态

### 需求 2：总览统计功能

**用户故事：** 作为项目管理者，我希望查看项目的整体进度和任务完成情况，以便了解项目状态

#### 接受标准

1. 当用户访问总览统计tab时，系统应显示以下项目册信息：
   - 总任务数量
   - 已完成任务数量
   - 任务完成率（百分比形式）
2. 系统应显示任务完成时间线图表
3. 如果任务数量超过100个，系统应采用虚拟滚动或分页优化性能
4. 当用户点击时间线上的任务时，系统应导航到任务详情页面
5. 时间线应按照任务完成时间排序，最新完成的在前

### 需求 3：消费统计 - 总预算和支出显示

**用户故事：** 作为财务管理者，我希望查看项目的预算和实际支出对比，以便控制项目成本

#### 接受标准

1. 当用户访问消费统计tab时，系统应显示：
   - 项目册中所有任务的总预算金额
   - 项目册中所有任务的总实际支出金额
2. 系统应以明显的方式展示预算和支出的对比
3. 如果实际支出超过预算，系统应以警示色显示

### 需求 4：消费统计 - 标签支出分析

**用户故事：** 作为财务管理者，我希望按标签查看支出分布，以便了解资金流向

#### 接受标准

1. 如果项目册中存在标签，系统应显示饼图展示各标签的实际支出占比
2. 饼图下方应显示标签详细列表，包含：
   - 标签名称
   - 支出占比（百分比）
   - 该标签下的任务数量
3. 标签列表应按实际支出金额从高到低排序
4. 如果没有标签，系统应显示适当的空状态提示

### 需求 5：消费统计 - 预算/支出视图切换

**用户故事：** 作为财务管理者，我希望能够在预算视图和实际支出视图间切换，以便进行不同维度的分析

#### 接受标准

1. 消费统计tab中应有切换按钮，允许用户在"实际支出"和"预算"两种视图间切换
2. 当切换到预算视图时：
   - 饼图应显示各标签的预算占比
   - 标签列表应显示预算金额和占比
   - 列表仍按金额从高到低排序
3. 当切换到实际支出视图时：
   - 饼图应显示各标签的实际支出占比
   - 标签列表应显示实际支出金额和占比
4. 系统应记住用户的视图选择偏好

### 需求 6：性能优化

**用户故事：** 作为用户，我希望统计页面加载快速且响应流畅，以便高效查看数据

#### 接受标准

1. 当任务数量大于100时，时间线应采用虚拟滚动或懒加载
2. 图表渲染应在500ms内完成
3. Tab切换应即时响应，无明显延迟
4. 数据加载时应显示加载状态指示器

### 需求 7：数据准确性

**用户故事：** 作为用户，我希望看到准确的统计数据，以便做出正确的决策

#### 接受标准

1. 系统应只统计未删除的任务数据
2. 完成率计算应基于所有层级的任务（包括子任务）
3. 预算和支出金额应实时反映最新数据
4. 如果任务没有设置预算或支出，应在计算中视为0