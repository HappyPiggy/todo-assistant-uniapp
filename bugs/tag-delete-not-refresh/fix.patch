# Tag删除后列表未刷新问题修复

## 修复要点

1. **清理currentTags数组**
   - 删除标签时，同时从currentTags中移除对应标签
   - 防止loadAvailableTags重新初始化选中状态时再次选中已删除的标签

2. **优化数据刷新流程**  
   - 使用新数组赋值替代直接修改，确保Vue能检测到变化
   - 在loadAvailableTags中先清空再赋值，强制触发响应式更新

3. **添加调试日志**
   - 在关键步骤添加日志输出，便于跟踪问题
   - 包括选中状态、标签数量、事件触发等信息

## 关键代码修改

### useTagManage.js - confirmDeleteTag方法
```javascript
// 立即从数组中移除，确保后续操作不会再引用这个标签
availableTags.value.splice(index, 1)

// 从选中列表中移除
if (selectedIndex > -1) {
  selectedTags.value.splice(selectedIndex, 1)
}

// 重要：同时从currentTags中移除，防止重新加载时又被选中
currentTagIndex = currentTags.value.findIndex(tag => {
  if (typeof tag === 'object' && tag.id) {
    return tag.id === tagId
  }
  return false
})
if (currentTagIndex > -1) {
  console.log('[confirmDeleteTag] 从currentTags中移除标签')
  currentTags.value.splice(currentTagIndex, 1)
}
```

### useTagManage.js - loadAvailableTags方法
```javascript
// 先清空再赋值，强制触发Vue响应式更新
availableTags.value = []
await nextTick()
availableTags.value = newAvailableTags
```

## 测试验证

1. 选中一个标签
2. 删除该标签
3. 确认标签从列表中消失
4. 确认选中状态被清除
5. 刷新页面确认数据一致性